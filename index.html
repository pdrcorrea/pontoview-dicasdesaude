<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PontoView • Dicas de Saúde</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800;900&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,650,0,0" />

  <style>
    :root{
      --ink:#0b1626;

      --topA:#0b2a44;
      --topB:#2c6aa3;
      --topC:#0f3d63;

      --pad: clamp(14px, 1.8vw, 26px);
      --gap: clamp(12px, 1.4vw, 18px);

      --panel:#e7edf5;
      --card: rgba(255,255,255,.78);
      --line: rgba(210,222,238,.95);

      --radius: clamp(24px, 2.2vw, 36px);
      --footerH: clamp(54px, 6vh, 78px);

      --ease: cubic-bezier(.2,.8,.2,1);
      --anim: 520ms;

      --dividerGrad: linear-gradient(90deg,
        rgba(44,106,163,0) 0%,
        rgba(44,106,163,.9) 18%,
        rgba(15,61,99,.95) 50%,
        rgba(44,106,163,.9) 82%,
        rgba(44,106,163,0) 100%
      );

      --bad:#ef4444;
      --badBg: rgba(239,68,68,.12);
      --badLine: rgba(239,68,68,.24);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:#fff;
      overflow:hidden;
    }

    .pvShell{
      width:100vw;
      height:100vh;
      display:flex;
      flex-direction:column;
      min-height:0;
      background:#fff;
    }

    /* ================= HEADER ================= */
    .pvHeader{
      position:relative;
      background: linear-gradient(180deg, var(--topB) 0%, var(--topC) 42%, var(--topA) 100%);
      color:#fff;
      padding: clamp(14px, 1.8vw, 22px) var(--pad);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:var(--gap);
      flex:0 0 auto;
      min-width:0;
      border-bottom: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 -1px 0 rgba(255,255,255,.18);
    }
    .pvHeader::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 120px at 50% 0%, rgba(255,255,255,.22), rgba(255,255,255,0) 65%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,0) 42%);
      opacity:.95;
    }

    .pvHeaderLeft, .pvHeaderRight{position:relative; z-index:1;}
    .pvHeaderLeft{
      display:flex;
      align-items:center;
      gap: clamp(12px, 1.5vw, 18px);
      min-width:0;
      flex:1 1 auto;
    }

    .pvIconBadge{
      width: clamp(44px, 4.2vw, 64px);
      height: clamp(44px, 4.2vw, 64px);
      border-radius: 18px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.24);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.20), 0 14px 28px rgba(0,0,0,.14);
      backdrop-filter: blur(10px);
      display:grid;
      place-items:center;
      flex:0 0 auto;
      color:#fff;
    }
    .pvIconBadge .material-symbols-outlined{
      font-size: 34px;
      line-height: 1;
      color:#fff;
      font-variation-settings:'FILL' 0,'wght' 650,'GRAD' 0,'opsz' 24;
      opacity:.98;
    }

    .pvTitles{display:flex; flex-direction:column; gap:6px; min-width:0;}
    .pvTitle{
      margin:0;
      font-size: clamp(18px, 2.1vw, 34px);
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      line-height:1.02;
    }

    .pvHeaderRight{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      min-width:max-content;
    }
    .pvPill{
      user-select:none;
      font-size: clamp(12px, 1.1vw, 16px);
      font-weight: 900;
      letter-spacing:.10em;
      text-transform: uppercase;
      color:#fff;
      padding: clamp(10px, 1.1vw, 14px) clamp(14px, 1.5vw, 22px);
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.18), 0 12px 26px rgba(0,0,0,.14);
      backdrop-filter: blur(10px);
      white-space:nowrap;
    }

    /* ================= MAIN ================= */
    .pvMain{
      flex:1 1 auto;
      min-height:0;
      padding: var(--pad);
      display:flex;
      overflow:hidden;
      background:#fff;
    }

    .panel{
      width:100%;
      min-height:0;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(231,237,245,1), rgba(223,232,244,1));
      padding: clamp(12px, 1.4vw, 18px);
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
      display:grid;
      grid-template-columns: 1fr;
      gap: var(--gap);
      align-items:stretch;
    }

    .card{
      border-radius: var(--radius);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
      background: var(--card);
      border: 1px solid var(--line);
      box-shadow: 0 12px 26px rgba(2,10,23,.10);
      backdrop-filter: blur(7px);
      position:relative;
    }

    .cardHeader{
      padding: clamp(16px, 1.8vw, 22px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex:0 0 auto;
      min-width:0;
      background: transparent;
    }
    .cardHeader .label{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color:#3b4b62;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      opacity:.95;
    }
    .toggleDots{display:flex; gap:8px; align-items:center;}
    .tdot{
      width:10px; height:10px; border-radius:999px;
      background:#c9d7ea;
      transition: all 420ms var(--ease);
    }
    .tdot.active{background:#2d76b9; width:22px;}

    .cardBody{
      flex:1 1 auto;
      min-height:0;
      padding: clamp(18px, 2.2vw, 30px);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: var(--gap);
      align-items:center;
      overflow:hidden;
    }

    .tipText{min-width:0}
    .tipKicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.86);
      border:1px solid rgba(210,222,238,.95);
      box-shadow: 0 10px 22px rgba(0,0,0,.05);
      width: fit-content;
      max-width: 100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.10em;
      text-transform: uppercase;
      color:#23344a;
    }
    .tipKicker .material-symbols-outlined{
      font-size: 18px;
      opacity:.9;
      font-variation-settings:'FILL' 0,'wght' 650,'GRAD' 0,'opsz' 24;
    }

    .tipTitle{
      margin: 16px 0 0;
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: 1.08;
      color: var(--ink);
      font-size: clamp(28px, 4.0vw, 58px);

      /* limita p/ não explodir */
      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:3;
      overflow:hidden;
    }

    .tipBody{
      margin: 12px 0 0;
      font-weight: 800;
      color: rgba(11,19,32,.58);
      font-size: clamp(14px, 1.55vw, 22px);
      line-height: 1.45;
      max-width: 64ch;

      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:4;
      overflow:hidden;
    }

    /* Bloco visual: ilustração SVG leve (sem depender de internet) */
    .tipArt{
      position:relative;
      border-radius: var(--radius);
      overflow:hidden;
      min-height: clamp(220px, 40vh, 620px);
      background: linear-gradient(180deg, var(--topB), var(--topA));
      box-shadow: 0 18px 60px rgba(2,10,23,.14);
    }
    .tipArt::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.22));
      pointer-events:none;
    }
    .tipArtInner{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      opacity:.95;
      transform: translateY(0);
      transition: opacity var(--anim) var(--ease), transform var(--anim) var(--ease), filter var(--anim) var(--ease);
      filter: blur(0px);
    }

    /* troca suave */
    .pvFadeOut .tipTitle,
    .pvFadeOut .tipBody,
    .pvFadeOut .tipKicker,
    .pvFadeOut .tipArtInner{
      opacity:0;
      transform: translateY(8px);
      filter: blur(1px);
    }
    .tipTitle, .tipBody, .tipKicker, .tipArtInner{
      transition: opacity var(--anim) var(--ease), transform var(--anim) var(--ease), filter var(--anim) var(--ease);
    }

    /* progress acima do rodapé */
    .progressWrap{
      flex:0 0 auto;
      padding: 0 var(--pad);
      background:#fff;
    }
    .divider{
      height: 4px;
      border-radius: 999px;
      background: var(--dividerGrad);
      position:relative;
      overflow:hidden;
    }
    #cycleFill{
      position:absolute;
      inset:0;
      width:0%;
      background: linear-gradient(90deg, rgba(255,255,255,.16), rgba(255,255,255,.38));
      mix-blend-mode: screen;
      border-radius: 999px;
      transition: width 120ms linear;
      transform-origin:left center;
    }

    /* footer com logo canto inferior direito */
    .pvFooter{
      flex:0 0 auto;
      height: var(--footerH);
      display:flex;
      align-items:center;
      justify-content:flex-end;
      padding: 10px var(--pad);
      background:#fff;
      gap: 12px;
      min-width:0;
    }
    .pvLogo{
      height: clamp(16px, 2.3vh, 22px);
      width:auto;
      display:block;
      opacity:.92;
    }

    /* OFFLINE overlay */
    .pvOffline{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: var(--pad);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 5;
    }
    .pvOfflineCard{
      width: min(980px, 92%);
      border-radius: 20px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.86);
      box-shadow: 0 14px 40px rgba(0,0,0,.10);
      padding: clamp(18px, 2.2vw, 30px);
      display:flex;
      gap: 18px;
      align-items:flex-start;
      backdrop-filter: blur(8px);
    }
    .pvOfflineIcon{
      width: 54px; height: 54px;
      border-radius: 16px;
      background: var(--badBg);
      border:1px solid var(--badLine);
      display:grid;
      place-items:center;
      flex:0 0 auto;
      color: var(--bad);
    }
    .pvOfflineIcon .material-symbols-outlined{
      font-size: 28px;
      font-variation-settings:'FILL' 0,'wght' 650,'GRAD' 0,'opsz' 24;
      opacity:.95;
    }
    .pvOfflineTitle{
      margin:0;
      font-weight: 900;
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: clamp(16px, 1.6vw, 22px);
      color:#0f172a;
    }
    .pvOfflineText{
      margin:10px 0 0;
      color:#334155;
      font-weight:800;
      font-size: clamp(14px, 1.5vw, 18px);
      line-height:1.35;
      opacity:.92;
    }
    .pvOfflineHint{
      margin:10px 0 0;
      color:#475569;
      font-weight:900;
      font-size: clamp(12px, 1.2vw, 14px);
      letter-spacing:.08em;
      text-transform: uppercase;
      opacity:.75;
    }

    @media (orientation: portrait){
      .cardBody{
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        align-items:stretch;
      }
      .tipArt{ min-height: clamp(220px, 36vh, 520px); }
      .tipTitle{ font-size: clamp(26px, 6.0vw, 54px); }
    }

    @media (prefers-reduced-motion: reduce){
      .tipTitle,.tipBody,.tipKicker,.tipArtInner{ transition:none; }
      #cycleFill{ transition:none !important; }
    }
  </style>
</head>

<body>
  <div class="pvShell" id="panel" data-title="DICAS DE SAÚDE">
    <header class="pvHeader">
      <div class="pvHeaderLeft">
        <div class="pvIconBadge" aria-hidden="true">
          <span class="material-symbols-outlined">health_and_safety</span>
        </div>
        <div class="pvTitles">
          <h1 class="pvTitle" id="titleHdr"></h1>
        </div>
      </div>

      <!-- opcional: “fonte” do conteúdo (sem online/offline) -->
      <div class="pvHeaderRight">
        <div class="pvPill" id="sourcePill">CONTEÚDO LOCAL</div>
      </div>
    </header>

    <main class="pvMain">
      <div class="panel">
        <section class="card" id="card">
          <div class="cardHeader">
            <div class="label" id="kickerSmall">BEM-ESTAR • PREVENÇÃO</div>
            <div class="toggleDots" aria-hidden="true">
              <div class="tdot active" id="dotA"></div>
              <div class="tdot" id="dotB"></div>
            </div>
          </div>

          <div class="cardBody" id="stage">
            <div class="tipText">
              <div class="tipKicker" id="tipKicker">
                <span class="material-symbols-outlined" id="tipIcon">water_drop</span>
                <span id="tipCat">HIDRATAÇÃO</span>
              </div>
              <h2 class="tipTitle" id="tipTitle">Hidrate-se ao longo do dia.</h2>
              <p class="tipBody" id="tipBody">Tome pequenos goles com frequência. Água ajuda na disposição, na circulação e no controle da temperatura corporal.</p>
            </div>

            <div class="tipArt" aria-hidden="true">
              <div class="tipArtInner" id="tipArtInner"></div>
            </div>
          </div>

          <!-- OFFLINE OVERLAY (sem badge) -->
          <div class="pvOffline" id="offlineLayer" aria-hidden="true">
            <div class="pvOfflineCard" role="status" aria-label="Modo offline">
              <div class="pvOfflineIcon" aria-hidden="true">
                <span class="material-symbols-outlined">wifi_off</span>
              </div>
              <div>
                <p class="pvOfflineTitle">MODO OFFLINE</p>
                <p class="pvOfflineText">
                  Sem conexão com a internet no momento. As dicas continuam sendo exibidas e o painel se atualiza automaticamente quando a conexão voltar.
                </p>
                <p class="pvOfflineHint">verificando conexão…</p>
              </div>
            </div>
          </div>

        </section>
      </div>
    </main>

    <!-- progress do ciclo acima do rodapé -->
    <div class="progressWrap" aria-hidden="true">
      <div class="divider"><div id="cycleFill"></div></div>
    </div>

    <!-- logo canto inferior direito -->
    <footer class="pvFooter" aria-label="Rodapé">
      <img class="pvLogo" src="assets/logo-pontoview.png" alt="PontoView" onerror="this.style.display='none'">
    </footer>
  </div>

  <script>
    /***********************
     * CONFIG
     ***********************/
    const ROTATE_MS = 16000;     // tempo entre dicas
    const TRANSITION_MS = 520;   // bate com CSS

    // Se quiser automatizar via Worker/endpoint:
    // Espera algo assim:
    // {
    //   "source": "SUA FONTE",
    //   "items": [
    //     {"cat":"Sono","title":"...","body":"...","icon":"bedtime","art":"waves"},
    //     ...
    //   ]
    // }
    // Deixe vazio para rodar 100% local.
    const REMOTE_TIPS_URL = ""; // ex: "https://seu-worker.seudominio.workers.dev/health"

    /***********************
     * CONTEÚDO LOCAL (mais “diferenciado”)
     * - icon: nome do Material Symbols (Outlined)
     * - art: id de ilustração leve (SVG)
     ***********************/
    const LOCAL_TIPS = [
      { cat:"Hidratação", icon:"water_drop", art:"waves",
        title:"Hidrate-se ao longo do dia.",
        body:"Tome pequenos goles com frequência. Água ajuda na disposição, na circulação e no controle da temperatura corporal." },

      { cat:"Respiração", icon:"air", art:"breath",
        title:"Faça 3 respirações lentas.",
        body:"Inspire pelo nariz por 4 segundos, segure 2, expire por 6. Isso reduz tensão e melhora o foco." },

      { cat:"Postura", icon:"accessible_forward", art:"posture",
        title:"Relaxe os ombros e apoie os pés.",
        body:"Uma postura confortável diminui dores no pescoço e lombar. Ajuste-se e descruze as pernas, se puder." },

      { cat:"Higiene das mãos", icon:"back_hand", art:"bubbles",
        title:"Higienize as mãos por 20 segundos.",
        body:"Esfregue palmas, dorso, entre os dedos e polegares. Essa simples ação reduz muito o risco de infecções." },

      { cat:"Sono", icon:"bedtime", art:"moon",
        title:"Sono é parte do tratamento.",
        body:"Rotina regular e menos telas antes de dormir ajudam o corpo a recuperar energia e regular hormônios." },

      { cat:"Movimento", icon:"directions_walk", art:"steps",
        title:"Movimento curto também conta.",
        body:"Levante, alongue e caminhe 2 minutos. Pequenas pausas melhoram circulação e reduzem rigidez." },

      { cat:"Alimentação", icon:"nutrition", art:"leaf",
        title:"Monte um prato mais colorido.",
        body:"Quanto mais cores naturais (verduras, legumes, frutas), maior a variedade de nutrientes e fibras." },

      { cat:"Segurança", icon:"medication", art:"shield",
        title:"Evite automedicação.",
        body:"Use medicamentos somente com orientação. Se tiver dúvidas, procure a equipe de saúde." },

      { cat:"Saúde mental", icon:"psychology", art:"spark",
        title:"Nomeie o que você está sentindo.",
        body:"Reconhecer emoções reduz ansiedade e melhora decisões. Se precisar, peça ajuda: você não está sozinho." },

      { cat:"Prevenção", icon:"vaccines", art:"dots",
        title:"Mantenha vacinas e exames em dia.",
        body:"A prevenção identifica problemas mais cedo e aumenta as chances de um cuidado mais simples e eficaz." },
    ];

    /***********************
     * ILUSTRAÇÕES (SVGs leves)
     ***********************/
    function artSVG(kind){
      const common = `viewBox="0 0 600 420" fill="none" xmlns="http://www.w3.org/2000/svg"`;
      if(kind === "waves"){
        return `<svg ${common}>
          <path opacity=".25" d="M0 290c80-40 140-40 220 0s150 40 230 0 150-40 150-40v170H0V290Z" fill="white"/>
          <path opacity=".22" d="M0 320c90-55 165-55 255 0s165 55 245 0 100-40 100-40v140H0V320Z" fill="white"/>
          <circle opacity=".18" cx="110" cy="140" r="70" fill="white"/>
          <circle opacity=".12" cx="470" cy="160" r="90" fill="white"/>
        </svg>`;
      }
      if(kind === "breath"){
        return `<svg ${common}>
          <circle opacity=".18" cx="210" cy="210" r="120" fill="white"/>
          <circle opacity=".10" cx="360" cy="210" r="150" fill="white"/>
          <path opacity=".24" d="M70 320c80-40 140-40 220 0s160 40 240 0" stroke="white" stroke-width="18" stroke-linecap="round"/>
          <path opacity=".22" d="M120 360c70-30 120-30 190 0s140 30 210 0" stroke="white" stroke-width="14" stroke-linecap="round"/>
        </svg>`;
      }
      if(kind === "posture"){
        return `<svg ${common}>
          <rect opacity=".16" x="90" y="270" width="420" height="40" rx="20" fill="white"/>
          <rect opacity=".14" x="170" y="110" width="260" height="140" rx="36" fill="white"/>
          <circle opacity=".18" cx="210" cy="160" r="34" fill="white"/>
          <path opacity=".22" d="M250 170c20 25 55 40 90 40 40 0 76-18 96-46" stroke="white" stroke-width="14" stroke-linecap="round"/>
        </svg>`;
      }
      if(kind === "bubbles"){
        return `<svg ${common}>
          <circle opacity=".18" cx="180" cy="150" r="70" fill="white"/>
          <circle opacity=".12" cx="260" cy="240" r="110" fill="white"/>
          <circle opacity=".12" cx="420" cy="170" r="90" fill="white"/>
          <circle opacity=".10" cx="470" cy="270" r="60" fill="white"/>
          <path opacity=".22" d="M120 330c90-60 180-60 270 0" stroke="white" stroke-width="16" stroke-linecap="round"/>
        </svg>`;
      }
      if(kind === "moon"){
        return `<svg ${common}>
          <circle opacity=".12" cx="420" cy="140" r="110" fill="white"/>
          <path opacity=".22" d="M445 80c-30 10-50 40-50 74 0 44 36 80 80 80 12 0 24-3 34-8-18 40-58 68-104 68-64 0-116-52-116-116 0-58 42-106 96-116Z" fill="white"/>
          <circle opacity=".10" cx="180" cy="270" r="90" fill="white"/>
        </svg>`;
      }
      if(kind === "steps"){
        return `<svg ${common}>
          <rect opacity=".16" x="120" y="260" width="140" height="60" rx="18" fill="white"/>
          <rect opacity=".14" x="250" y="210" width="160" height="60" rx="18" fill="white"/>
          <rect opacity=".12" x="380" y="160" width="140" height="60" rx="18" fill="white"/>
          <circle opacity=".10" cx="140" cy="150" r="70" fill="white"/>
        </svg>`;
      }
      if(kind === "leaf"){
        return `<svg ${common}>
          <path opacity=".20" d="M320 90c90 20 150 100 150 170 0 80-70 130-150 130-100 0-190-80-190-190 0-50 20-90 60-110 20 70 80 120 130 130-10-40-10-90 0-130Z" fill="white"/>
          <path opacity=".18" d="M220 280c60-40 120-90 190-170" stroke="white" stroke-width="14" stroke-linecap="round"/>
          <circle opacity=".10" cx="170" cy="150" r="70" fill="white"/>
        </svg>`;
      }
      if(kind === "shield"){
        return `<svg ${common}>
          <path opacity=".20" d="M300 70c90 50 160 40 160 40v140c0 110-90 150-160 180-70-30-160-70-160-180V110s70 10 160-40Z" fill="white"/>
          <path opacity=".18" d="M240 240h120" stroke="white" stroke-width="16" stroke-linecap="round"/>
          <path opacity=".18" d="M300 180v120" stroke="white" stroke-width="16" stroke-linecap="round"/>
          <circle opacity=".10" cx="120" cy="150" r="70" fill="white"/>
        </svg>`;
      }
      if(kind === "spark"){
        return `<svg ${common}>
          <circle opacity=".14" cx="200" cy="220" r="120" fill="white"/>
          <circle opacity=".10" cx="430" cy="170" r="90" fill="white"/>
          <path opacity=".22" d="M300 120l16 54 54 16-54 16-16 54-16-54-54-16 54-16 16-54Z" fill="white"/>
          <path opacity=".18" d="M420 260l10 34 34 10-34 10-10 34-10-34-34-10 34-10 10-34Z" fill="white"/>
        </svg>`;
      }
      if(kind === "dots"){
        return `<svg ${common}>
          <circle opacity=".16" cx="190" cy="160" r="80" fill="white"/>
          <circle opacity=".10" cx="420" cy="240" r="120" fill="white"/>
          <g opacity=".22" fill="white">
            <circle cx="130" cy="310" r="10"/><circle cx="170" cy="330" r="8"/><circle cx="210" cy="300" r="9"/>
            <circle cx="450" cy="120" r="9"/><circle cx="480" cy="150" r="7"/><circle cx="410" cy="150" r="8"/>
          </g>
        </svg>`;
      }
      return `<svg ${common}><circle opacity=".14" cx="300" cy="210" r="160" fill="white"/></svg>`;
    }

    /***********************
     * HELPERS
     ***********************/
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    function safeText(s, max=180){
      if(!s) return "";
      const t = String(s).replace(/\s+/g," ").trim();
      return t.length > max ? t.slice(0,max).replace(/\s+\S*$/,"").trim()+"…" : t;
    }

    /***********************
     * REMOTO (opcional)
     ***********************/
    const sourcePill = document.getElementById("sourcePill");
    let tips = LOCAL_TIPS.slice();

    async function tryLoadRemote(){
      if(!REMOTE_TIPS_URL) return false;
      try{
        const r = await fetch(REMOTE_TIPS_URL, { cache:"no-store" });
        if(!r.ok) throw new Error("HTTP "+r.status);
        const j = await r.json();
        const items = Array.isArray(j.items) ? j.items : null;
        if(!items || !items.length) return false;

        const cleaned = items.map(x => ({
          cat: safeText(x.cat || "Saúde", 28),
          icon: safeText(x.icon || "health_and_safety", 40),
          art: safeText(x.art || "waves", 24),
          title: safeText(x.title || "Dica de saúde", 120),
          body: safeText(x.body || "", 220),
        })).filter(x => x.title && x.body);

        if(!cleaned.length) return false;

        tips = cleaned;
        sourcePill.textContent = (j.source ? safeText(j.source, 22) : "CONTEÚDO ONLINE").toUpperCase();
        return true;
      }catch(e){
        return false;
      }
    }

    /***********************
     * UI
     ***********************/
    document.getElementById("titleHdr").textContent =
      document.getElementById("panel").dataset.title || "DICAS DE SAÚDE";

    const stage = document.getElementById("stage");
    const tipIcon = document.getElementById("tipIcon");
    const tipCat  = document.getElementById("tipCat");
    const tipTitle= document.getElementById("tipTitle");
    const tipBody = document.getElementById("tipBody");
    const artHost = document.getElementById("tipArtInner");
    const kickerSmall = document.getElementById("kickerSmall");

    const offlineLayer = document.getElementById("offlineLayer");

    const dotA = document.getElementById("dotA");
    const dotB = document.getElementById("dotB");

    /***********************
     * PROGRESS
     ***********************/
    const cycleFill = document.getElementById("cycleFill");
    let rotStart = performance.now();

    function animateProgress(now){
      const p = ((now - rotStart) % ROTATE_MS) / ROTATE_MS;
      cycleFill.style.width = `${Math.max(2, p*100)}%`;
      requestAnimationFrame(animateProgress);
    }
    requestAnimationFrame(animateProgress);

    /***********************
     * ROTATION
     ***********************/
    let pool = shuffle(tips);
    let idx = 0;

    function resetPool(){
      pool = shuffle(tips);
      idx = 0;
    }

    function flipDots(){
      const aActive = dotA.classList.contains("active");
      dotA.classList.toggle("active", !aActive);
      dotB.classList.toggle("active", aActive);
    }

    function setTip(t){
      stage.classList.add("pvFadeOut");
      setTimeout(()=>{
        tipIcon.textContent = t.icon || "health_and_safety";
        tipCat.textContent  = (t.cat || "Saúde").toUpperCase();
        tipTitle.textContent= t.title || "Dica de saúde";
        tipBody.textContent = t.body || "";

        kickerSmall.textContent =
          `${(t.cat || "SAÚDE").toUpperCase()} • DICAS RÁPIDAS`;

        artHost.innerHTML = artSVG(t.art || "waves");

        stage.classList.remove("pvFadeOut");
      }, TRANSITION_MS);
    }

    function step(){
      if(!pool.length) return;
      rotStart = performance.now();
      flipDots();
      setTip(pool[idx++ % pool.length]);
    }

    /***********************
     * OFFLINE OVERLAY (sem badge)
     ***********************/
    function setOfflineOverlay(){
      const isOnline = navigator.onLine;
      offlineLayer.style.display = isOnline ? "none" : "flex";
      offlineLayer.setAttribute("aria-hidden", isOnline ? "true" : "false");
    }

    /***********************
     * START
     ***********************/
    (async ()=>{
      // online/offline overlay
      setOfflineOverlay();
      window.addEventListener("online", setOfflineOverlay);
      window.addEventListener("offline", setOfflineOverlay);
      setInterval(setOfflineOverlay, 5000);

      // tenta remoto (se configurado); se falhar, fica no local
      const ok = await tryLoadRemote();
      if(ok){
        resetPool();
      }else{
        sourcePill.textContent = "CONTEÚDO LOCAL";
        resetPool();
      }

      // primeiro render
      setTip(pool[0]);
      rotStart = performance.now();
      setInterval(step, ROTATE_MS);
    })();
  </script>
</body>
</html>
